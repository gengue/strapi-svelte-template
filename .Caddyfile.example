# https://medium.com/@devahmedshendy/traditional-setup-run-local-development-over-https-using-caddy-964884e75232
# 1. sudo pacman -S mkcert
# 2. mkdir ./certs && cd ./certs
# 3. mkcert "*.sqila.local"
# 4. new line /etc/hosts/ -> 127.0.0.1 backend.sqila.local app.sqila.local

backend.sqila.local {
  tls ./certs/_wildcard.sqila.local.pem ./certs/_wildcard.sqila.local-key.pem
    reverse_proxy localhost:1337 {
      header_up Host                {host}
      header_up Origin              {host}
      header_up X-Real-IP           {remote}
      header_up X-Forwarded-Host    {host}
      header_up X-Forwarded-Server  {host}
      header_up X-Forwarded-Port    {port}
      header_up X-Forwarded-For     {remote}
      header_up X-Forwarded-Proto   {scheme}
      header_down Access-Control-Allow-Origin       https://app.sqila.local
      header_down Access-Control-Allow-Credentials  true
    }
}


app.sqila.local {
  encode gzip zstd
  tls ./certs/_wildcard.sqila.local.pem ./certs/_wildcard.sqila.local-key.pem
    reverse_proxy localhost:3000 {
      header_up Host                "localhost"
      header_up X-Real-IP           {remote}
      header_up X-Forwarded-Host    "localhost"
      header_up X-Forwarded-Server  "localhost"
      header_up X-Forwarded-Port    {port}
      header_up X-Forwarded-For     {remote}
      header_up X-Forwarded-Proto   {scheme}
    }

  file_server
}
